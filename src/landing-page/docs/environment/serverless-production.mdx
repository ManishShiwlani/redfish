---
path: '/docs/environment/serverless-production'
title: 'Serverless production'
order: 3
section: 'environment'
sectionOrder: 1
---

# Serverless production

## Prerequisites:

- Have accounts on GitHub, [ZEIT](https://zeit.co/), [Netlify](https://www.netlify.com/), and [AWS](https://aws.amazon.com/).

In this tutorial, we explain how to deploy the Redfish server using GitHub private repo, [ZEIT Now](https://zeit.co/), and [AWS](https://aws.amazon.com/). _You can deploy the Django server in another way._

## 1. Set up GitHub private production repository

ZEIT Now is able to run apps from GitHub. Once we deploy changes to GitHub it automaticaly update the server. To keep our credentials save, we should deploy them to a private repository.

- [Create](https://github.com/new) empty GitHub private repository
- Add `production` remote to your local development environment:

```shell
$ git remote add production https://github.com/username/app-name-production.git
```

- Make sure you have both `origin` and `production` remotes:

```shell
$ git remote -v
origin  git@github.com:username/app-name.git (fetch)
origin  git@github.com:username/app-name.git (push)
production      git@github.com:username/app-name-production.git (fetch)
production      git@github.com:username/app-name-production.git (push)
```

- Push your local development instance to production rep:

```shell
$ git push production master
```

Now you should see files inside production repo on GitHub.

_WARNING NOTE: Do not pull this rep from your development environment. Otherwise, git overrides your settings.py file and may cause a leak of credentials. \
You are free to use `git pull` without specifying a remote, since it pulls only origin remote._

## 2. Prepare `settings.py` file

- Go to `app-name-production/src/django_server/django_server/` folder in production repo on GitHub website;
- Open `settings.prod.py` file and copy the content to the clipboard;
- Create new `settings.py` file in the same directory, and paste the content from the clipboard;
- Keep it open for further edits.

* Generate `SECRET_KEY`:

```shell
$ python redfish/generate_secret_key.py
Paste the next string to the settings.py SECRET_KEY constant
kpvmoz93s_3*rs7i*$t5-g%x5df7!vr(7=$ie2$6pj%!5=e*8@
```

- Copy and paste it to the `settings.py`:

```python
# settings.py
SECRET_KEY = 'kpvmoz93s_3*rs7i*$t5-g%x5df7!vr(7=$ie2$6pj%!5=e*8@'
```

- Open `settings.py` file at your dev environment:

```shell
$ vim django_server/settings.py
```

- Copy the email SMTP setup section and paste to the production `settings.py` on GitHub:

```python
# settings.py
...
EMAIL_HOST_USER = 'example@gmail.com'
EMAIL_HOST_PASSWORD = 'vcnstblmegxxkvkf'
...
```

## 2. Setup AWS

### 2.1. Provide AWS Region

- Go to [AWS Regions and Endpoints](https://docs.aws.amazon.com/general/latest/gr/rande.html), copy and paste the value of your region into the `settings.py` file;

```python
# settings.py
...
# The AWS region to connect to.
AWS_REGION = "eu-central-1"
...
```

### 2.2. Create AWS credentials.

- Go to [IAM Management Console](https://console.aws.amazon.com/iam/home?#/users) and **create a new user** with **Programmatic access**.
- Create a group with **AmazonRDSFullAccess** and **AmazonS3FullAccess** policies and add created user there.
- Copy **Access Key ID** and **Secret Access Key** and paste them into `settings.py` file

```python
# settings.py
...
# The AWS access key to use.
AWS_ACCESS_KEY_ID = "AKIAR2BBJGZAVGG2RF6A"

# The AWS secret access key to use.
AWS_SECRET_ACCESS_KEY = "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"
...
```

### 2.2. Setup [S3 bucket](https://s3.console.aws.amazon.com/s3/):

S3 service is the place where we collect static files. <br/>

- Create S3 service with next **Block public access** settings:

* [ ] Block all public access
* [ ] Block public access to buckets and objects granted through new access control lists (ACLs)
* [ ] Block public access to buckets and objects granted through any access control lists (ACLs)
* [x] Block public access to buckets and objects granted through new public bucket policies
* [x] Block public and cross-account access to buckets and objects through any public bucket policies

- Copy and Paste the name of the S3 bucket to the `settings.py` file:

```python
# settings.py
...
S3_BUCKET = "name-of-your-s3-bucket"
...
```

### 2.3. Setup [RDS database](https://console.aws.amazon.com/rds/):

- [Create](https://console.aws.amazon.com/rds/home) PostgreSQL database
- Set `DATABASES` in the `settings.py` file:

```python
# settings.py
...
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'redfish-database-1', # dbname
        'USER': 'postgres', # master username
        'PASSWORD': 'oWdpawvro4zPdxzVobch', # master password
        'HOST': 'redfish-database-1.c7awambotayj.eu-central-1.rds.amazonaws.com', # Endpoint
        'PORT': '5432',
    }
}
...
```

_\* Provided credentials are not real and exposed only for demonstration purposes._
